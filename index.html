<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FB Style Social</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script> 
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Roboto', sans-serif; background-color: #f0f2f5; margin: 0; padding-bottom: 60px; height: 100dvh; overflow: hidden; }

        /* --- Loading & Login --- */
        #loadingOverlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.8); z-index: 3000;
            justify-content: center; align-items: center;
        }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #1877f2; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #loginScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .login-btn { background: #1877f2; color: white; border: none; padding: 12px 30px; border-radius: 6px; font-weight: bold; cursor: pointer; }

        /* --- Main Layout --- */
        #appInterface { display: none; height: 100%; flex-direction: column; }
        .header { background: white; padding: 12px 15px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { margin: 0; color: #1877f2; font-size: 24px; font-weight: 800; }
        
        .content-area { flex: 1; overflow-y: auto; background: #c9ccd1; } /* Darker bg for separation */
        .tab-content { display: none; }
        .active-tab { display: block; }

        /* --- Create Post --- */
        .create-post { background: white; padding: 15px; margin-bottom: 8px; }
        .cp-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .cp-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        .cp-input { flex: 1; border: none; background: #f0f2f5; border-radius: 20px; padding: 10px 15px; outline: none; }
        .post-btn { background: #1877f2; color: white; border: none; padding: 6px 20px; border-radius: 6px; font-weight: bold; cursor: pointer; width: 100%; }

        /* --- Post Card (FB Style) --- */
        .post-card { background: white; margin-bottom: 8px; padding-top: 10px; }
        .pc-header { padding: 0 15px 10px; display: flex; justify-content: space-between; align-items: flex-start; }
        .pc-user { display: flex; gap: 10px; }
        .pc-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        .pc-info h4 { margin: 0; font-size: 15px; color: #050505; }
        .pc-info span { font-size: 12px; color: #65676b; }
        .delete-btn { color: #65676b; font-size: 18px; cursor: pointer; }

        .pc-content { padding: 0 15px 10px; font-size: 15px; color: #050505; }
        .pc-image { width: 100%; display: block; max-height: 500px; object-fit: cover; }

        /* Stats & Actions */
        .pc-stats { padding: 10px 15px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; color: #65676b; font-size: 13px; }
        .pc-actions { display: flex; padding: 5px 0; }
        .action-btn { flex: 1; background: none; border: none; padding: 8px; color: #65676b; font-weight: 600; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 6px; font-size: 14px; }
        .action-btn:active { background: #f0f2f5; }
        .liked { color: #1877f2; }

        /* --- Comments Modal (Bottom Sheet) --- */
        #commentModal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1500; display: none; justify-content: center; align-items: flex-end;
        }
        .cm-content {
            background: white; width: 100%; height: 70%; border-radius: 15px 15px 0 0;
            display: flex; flex-direction: column; animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .cm-header { padding: 15px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
        .cm-list { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 15px; }
        
        .comment-row { display: flex; gap: 10px; }
        .cmt-avatar { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; }
        .cmt-bubble { background: #f0f2f5; padding: 8px 12px; border-radius: 15px; }
        .cmt-name { font-weight: bold; font-size: 13px; color: #050505; display: block; }
        .cmt-text { font-size: 14px; }

        .cm-input-area { padding: 10px; border-top: 1px solid #ddd; display: flex; gap: 10px; }
        .cm-input { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ddd; outline: none; background: #f0f2f5; }

        /* --- Friend List --- */
        .friend-row { padding: 15px; background: white; display: flex; align-items: center; border-bottom: 1px solid #eee; gap: 15px; }
        .friend-row:active { background: #f0f2f5; }

        /* --- Profile Tab --- */
        .profile-card { background: white; padding: 20px; text-align: center; }
        .edit-input { padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 70%; text-align: center; font-size: 16px; margin: 10px 0; }
        .save-btn { background: #42b72a; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; }

        /* --- Bottom Nav --- */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; height: 55px; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #ddd; z-index: 1000; }
        .nav-item { font-size: 24px; color: #65676b; cursor: pointer; }
        .nav-active { color: #1877f2; }

        /* --- Private Chat Overlay --- */
        #chatOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 2500; display: none; flex-direction: column; }
        .chat-header { padding: 10px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 10px; }
        .chat-body { flex: 1; overflow-y: auto; padding: 15px; background: white; display: flex; flex-direction: column; gap: 5px; }
        .chat-bubble { padding: 8px 12px; border-radius: 18px; max-width: 75%; font-size: 15px; }
        .me { background: #0084ff; color: white; align-self: flex-end; }
        .other { background: #f0f0f0; color: black; align-self: flex-start; }
    </style>
</head>
<body>

    <div id="loadingOverlay"><div class="spinner"></div></div>

    <div id="loginScreen">
        <h1 style="color:#1877f2; font-size:40px; font-weight:bold; margin-bottom:20px;">facebook</h1>
        <button class="login-btn" onclick="googleLogin()">Log In with Google</button>
    </div>

    <div id="appInterface">
        <div class="header">
            <h1>facebook</h1>
            <img id="myHeaderPic" src="" style="width:35px; height:35px; border-radius:50%;" onclick="switchTab('profile')">
        </div>

        <div class="content-area">
            
            <div id="homeTab" class="tab-content active-tab">
                <div class="create-post">
                    <div class="cp-row">
                        <img id="postAvatar" class="cp-avatar" src="">
                        <input type="text" id="postInput" class="cp-input" placeholder="What's on your mind?">
                    </div>
                    <img id="previewImg" style="width:100%; border-radius:8px; display:none; margin-bottom:10px;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <label for="postImg" style="color:#45bd62; font-weight:bold; cursor:pointer; display:flex; align-items:center; gap:5px;">
                            üñºÔ∏è Photo
                        </label>
                        <input type="file" id="postImg" accept="image/*" style="display:none" onchange="previewFile()">
                        <button class="post-btn" style="width:auto;" onclick="submitPost()">Post</button>
                    </div>
                </div>
                <div id="feedContainer"></div>
            </div>

            <div id="friendsTab" class="tab-content">
                <div id="friendsList"></div>
            </div>

            <div id="profileTab" class="tab-content">
                <div class="profile-card">
                    <img id="profileBigPic" src="" style="width:120px; height:120px; border-radius:50%; border:3px solid #1877f2; margin-bottom:15px;">
                    <br>
                    <label style="color:#1877f2; font-weight:bold; cursor:pointer;">
                        Change Photo
                        <input type="file" id="newProfileImg" accept="image/*" style="display:none" onchange="changeProfilePic()">
                    </label>
                    <br><br>
                    
                    <div style="margin-bottom: 5px; color:#65676b; font-size:12px;">Display Name</div>
                    <input type="text" id="editNameInput" class="edit-input">
                    <br>
                    <button class="save-btn" onclick="saveName()">Save Name</button>
                    
                    <br><br><br>
                    <button onclick="auth.signOut()" style="background:#e4e6eb; border:none; padding:10px 20px; border-radius:6px; font-weight:bold;">Log Out</button>
                </div>
            </div>

        </div>

        <div class="bottom-nav">
            <div class="nav-item nav-active" onclick="switchTab('home')">üè†</div>
            <div class="nav-item" onclick="switchTab('friends')">üë•</div>
            <div class="nav-item" onclick="switchTab('profile')">üë§</div>
        </div>
    </div>

    <div id="commentModal">
        <div class="cm-content">
            <div class="cm-header">
                <span>Comments</span>
                <span onclick="closeComments()" style="cursor:pointer; font-size:20px;">‚úï</span>
            </div>
            <div class="cm-list" id="commentList"></div>
            <div class="cm-input-area">
                <input type="text" id="commentInput" class="cm-input" placeholder="Write a comment...">
                <button onclick="submitComment()" style="border:none; background:none; color:#1877f2; font-weight:bold;">‚û§</button>
            </div>
        </div>
    </div>

    <div id="chatOverlay">
        <div class="chat-header">
            <button onclick="closeChat()" style="border:none; background:none; font-size:24px;">‚Üê</button>
            <span id="chatPartnerName" style="font-weight:bold;">User</span>
        </div>
        <div class="chat-body" id="chatBody"></div>
        <div style="padding:10px; display:flex; gap:10px; border-top:1px solid #eee;">
            <input type="text" id="chatInput" style="flex:1; padding:10px; border-radius:20px; border:1px solid #ddd;" placeholder="Message...">
            <button onclick="sendChat()" style="border:none; background:none; font-size:24px; color:#1877f2;">‚û§</button>
        </div>
    </div>

<script>
    // ------------------------------------------------
    // ‚ö†Ô∏è CONFIGURATION (Replace with yours)
    // ------------------------------------------------
    const firebaseConfig = {
  apiKey: "AIzaSyCUteIjOOPxPYrCutDSo9t0cVtLqnGTWxU",
  authDomain: "chat-27f21.firebaseapp.com",
  projectId: "chat-27f21",
  storageBucket: "chat-27f21.firebasestorage.app",
  messagingSenderId: "582814616396",
  appId: "1:582814616396:web:251660e2a50635bc70dde9"
};
    const ADMIN_EMAIL = "mmtintaungkhaing@gmail.com"; 
    // ------------------------------------------------

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    
    let currentUser = null;
    let myData = {};
    let currentPostIdForComments = null;
    let currentChatId = null;

    // Auth & Init
    auth.onAuthStateChanged(user => {
        if (user) {
            currentUser = user;
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appInterface').style.display = 'flex';
            
            // User Data Setup
            const docRef = db.collection('users').doc(user.uid);
            docRef.onSnapshot(doc => {
                if (doc.exists) {
                    myData = doc.data();
                } else {
                    myData = { 
                        name: user.displayName, 
                        photo: user.photoURL, 
                        email: user.email, 
                        uid: user.uid,
                        isAdmin: (user.email === ADMIN_EMAIL)
                    };
                    docRef.set(myData);
                }
                updateUI();
                loadFriends();
            });
            loadFeed();
        } else {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('appInterface').style.display = 'none';
        }
    });

    function googleLogin() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
    function updateUI() {
        document.getElementById('myHeaderPic').src = myData.photo;
        document.getElementById('postAvatar').src = myData.photo;
        document.getElementById('profileBigPic').src = myData.photo;
        document.getElementById('editNameInput').value = myData.name;
    }

    // --- Tab Logic ---
    function switchTab(tab) {
        document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('nav-active'));
        
        if (tab === 'home') {
            document.getElementById('homeTab').style.display = 'block';
            document.querySelectorAll('.nav-item')[0].classList.add('nav-active');
        } else if (tab === 'friends') {
            document.getElementById('friendsTab').style.display = 'block';
            document.querySelectorAll('.nav-item')[1].classList.add('nav-active');
        } else {
            document.getElementById('profileTab').style.display = 'block';
            document.querySelectorAll('.nav-item')[2].classList.add('nav-active');
        }
    }

    // --- Profile & Name Edit ---
    function saveName() {
        const newName = document.getElementById('editNameInput').value;
        if (newName) {
            db.collection('users').doc(currentUser.uid).update({ name: newName }).then(() => alert("Name Updated!"));
        }
    }
    function changeProfilePic() {
        const file = document.getElementById('newProfileImg').files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = e => {
                db.collection('users').doc(currentUser.uid).update({ photo: e.target.result });
            };
            reader.readAsDataURL(file);
        }
    }

    // --- Feed & Interaction ---
    function previewFile() {
        const file = document.getElementById('postImg').files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById('previewImg').src = e.target.result;
                document.getElementById('previewImg').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    }

    function submitPost() {
        const text = document.getElementById('postInput').value;
        const img = document.getElementById('previewImg').src;
        const file = document.getElementById('postImg').files[0];

        if (!text && !file) return;
        document.getElementById('loadingOverlay').style.display = 'flex';

        const save = (image) => {
            db.collection('posts').add({
                text: text,
                image: image,
                uid: currentUser.uid,
                authorName: myData.name,
                authorPhoto: myData.photo,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                likes: [], // Array for likes
                isAdmin: myData.isAdmin || false
            }).then(() => {
                document.getElementById('loadingOverlay').style.display = 'none';
                document.getElementById('postInput').value = "";
                document.getElementById('previewImg').style.display = 'none';
                document.getElementById('postImg').value = "";
            });
        }

        if (file) {
            const reader = new FileReader();
            reader.onload = e => save(e.target.result);
            reader.readAsDataURL(file);
        } else {
            save(null);
        }
    }

    function loadFeed() {
        db.collection('posts').orderBy('timestamp', 'desc').onSnapshot(snap => {
            const container = document.getElementById('feedContainer');
            container.innerHTML = "";
            snap.forEach(doc => {
                const p = doc.data();
                const pid = doc.id;
                const isLiked = p.likes && p.likes.includes(currentUser.uid);
                const likeCount = p.likes ? p.likes.length : 0;
                
                // Admin Badge
                const badge = p.isAdmin ? `<span style="color:#1877f2; margin-left:4px;">‚úì</span>` : ``;
                
                // Delete Button (Only for owner or admin)
                let delBtn = "";
                if (currentUser.uid === p.uid || myData.isAdmin) {
                    delBtn = `<span class="delete-btn" onclick="deletePost('${pid}')">üóëÔ∏è</span>`;
                }

                const html = `
                    <div class="post-card">
                        <div class="pc-header">
                            <div class="pc-user" onclick="startChat('${p.uid}', '${p.authorName}')">
                                <img src="${p.authorPhoto}" class="pc-avatar">
                                <div class="pc-info">
                                    <h4>${p.authorName} ${badge}</h4>
                                    <span>${p.timestamp ? new Date(p.timestamp.toDate()).toLocaleString() : ''}</span>
                                </div>
                            </div>
                            ${delBtn}
                        </div>
                        <div class="pc-content">
                            <p>${p.text || ''}</p>
                            ${p.image ? `<img src="${p.image}" class="pc-image">` : ''}
                        </div>
                        <div class="pc-stats">
                            <span>${likeCount > 0 ? '‚ô• ' + likeCount : ''}</span>
                            <span onclick="openComments('${pid}')">Comments</span>
                        </div>
                        <div class="pc-actions">
                            <button class="action-btn ${isLiked ? 'liked' : ''}" onclick="toggleLike('${pid}', ${isLiked})">
                                <span>${isLiked ? '‚ô• Liked' : '‚ô° Like'}</span>
                            </button>
                            <button class="action-btn" onclick="openComments('${pid}')">
                                <span>üí¨ Comment</span>
                            </button>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        });
    }

    function deletePost(id) {
        if(confirm("Delete this post?")) db.collection('posts').doc(id).delete();
    }

    // --- Like System ---
    function toggleLike(pid, isLiked) {
        const ref = db.collection('posts').doc(pid);
        if (isLiked) {
            ref.update({ likes: firebase.firestore.FieldValue.arrayRemove(currentUser.uid) });
        } else {
            ref.update({ likes: firebase.firestore.FieldValue.arrayUnion(currentUser.uid) });
        }
    }

    // --- Comment System ---
    function openComments(pid) {
        currentPostIdForComments = pid;
        document.getElementById('commentModal').style.display = 'flex';
        
        // Load Comments
        db.collection('comments').where('postId', '==', pid).orderBy('timestamp', 'asc').onSnapshot(snap => {
            const list = document.getElementById('commentList');
            list.innerHTML = "";
            snap.forEach(doc => {
                const c = doc.data();
                list.innerHTML += `
                    <div class="comment-row">
                        <img src="${c.userPhoto}" class="cmt-avatar">
                        <div class="cmt-bubble">
                            <span class="cmt-name">${c.userName}</span>
                            <span class="cmt-text">${c.text}</span>
                        </div>
                    </div>
                `;
            });
        });
    }
    
    function closeComments() { document.getElementById('commentModal').style.display = 'none'; }

    function submitComment() {
        const txt = document.getElementById('commentInput').value;
        if (!txt || !currentPostIdForComments) return;
        
        db.collection('comments').add({
            postId: currentPostIdForComments,
            text: txt,
            uid: currentUser.uid,
            userName: myData.name,
            userPhoto: myData.photo,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        document.getElementById('commentInput').value = "";
    }

    // --- Friend & Chat System ---
    function loadFriends() {
        db.collection('users').onSnapshot(snap => {
            const list = document.getElementById('friendsList');
            list.innerHTML = "";
            snap.forEach(doc => {
                const u = doc.data();
                if (u.uid !== currentUser.uid) {
                    list.innerHTML += `
                        <div class="friend-row" onclick="startChat('${u.uid}', '${u.name}')">
                            <img src="${u.photo}" style="width:40px; height:40px; border-radius:50%;">
                            <span style="font-weight:bold; flex:1;">${u.name}</span>
                            <span>üí¨</span>
                        </div>
                    `;
                }
            });
        });
    }

    function startChat(uid, name) {
        const ids = [currentUser.uid, uid].sort();
        currentChatId = ids.join("_");
        document.getElementById('chatPartnerName').innerText = name;
        document.getElementById('chatOverlay').style.display = 'flex';
        
        db.collection('messages').where('chatId', '==', currentChatId).orderBy('timestamp', 'asc').onSnapshot(snap => {
            const body = document.getElementById('chatBody');
            body.innerHTML = "";
            snap.forEach(doc => {
                const m = doc.data();
                const cls = m.sender === currentUser.uid ? 'me' : 'other';
                body.innerHTML += `<div class="chat-bubble ${cls}">${m.text}</div>`;
            });
            body.scrollTop = body.scrollHeight;
        });
    }

    function closeChat() { document.getElementById('chatOverlay').style.display = 'none'; }
    function sendChat() {
        const txt = document.getElementById('chatInput').value;
        if (!txt) return;
        db.collection('messages').add({
            chatId: currentChatId,
            text: txt,
            sender: currentUser.uid,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        document.getElementById('chatInput').value = "";
    }

</script>
</body>
</html>
